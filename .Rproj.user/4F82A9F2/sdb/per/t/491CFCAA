{
    "collab_server" : "",
    "contents" : "\n# /----------------------------------------------------------------------------#\n#/   MAKE LIST OF ALL PRED & DISTRIB RASTERS\n\n# get list of all pred catches\npred_catch_dir <- '../output/results/pred_catch/'\npred_catch_ls <- list.files(pred_catch_dir)\npred_catch_ls <- unlist(lapply(pred_catch_ls, function(x){ paste0(pred_catch_dir, x) }))\n\n\n# get list of files for all distrib catches.\ndistrib_catch_dir <- '../output/results/distrib_catch/'\ndistrib_catch_ls <- list.files(distrib_catch_dir)\ndistrib_catch_ls <- unlist(lapply(distrib_catch_ls, function(x){ paste0(distrib_catch_dir, x) }))\n\n# Combine lists\ncatch_ls <- c(pred_catch_ls, distrib_catch_ls)\n\n\n\n# /----------------------------------------------------------------------------#\n#/ Get river basin shapefile\nbasins_file = '../data/river_basins/catch_bas_all_dissolved_v2.shp'\nbasins <- readOGR(basins_file)#, 'ne_110m_admin_0_countries')\nbasins@data$ID <- as.numeric(rownames(basins@data)) + 1 # add numeric id\n\n\n# /----------------------------------------------------------------------------#\n#/ get basin catch (from McIntyre 2016)\nbasin_catch <- read.csv('../data/basin_catch/river_fisheries_pete_catch.csv') %>% \n  select(WB_NAME2, CATCH, CATCHUNITS) %>% \n  filter(!is.na(CATCH))\n\n# Black Volta; Pandjari; Pearl; Red Volta; Rufiji/Ruaha; White Volta; San Francisco\n\n\n\n# /----------------------------------------------------------------------------@\n#/ create output df\noutdf <- data.frame(name=as.character(),\n                    sumarea=as.numeric())\n\ncatch_stack <- stack()\n\n\nlibrary(Metrics)\n\n# /----------------------------------------------------------------------------#\n#/ loop through pred catch grids; get global sum\nfor (c in catch_ls){\n  \n  \n  print(c)\n  \n  # Get global sum\n  r <- raster(c)\n  s <- sum_raster(r)/10^6\n  \n  outdf <- bind_rows(outdf,\n                     data.frame(name=c, sumarea= s) )\n\n}\n\n\n# /----------------------------------------------------------------------------#\n#/  Extract cath in basins\n\nex <- raster::extract(r, basins, fun=sum, na.rm=TRUE, df=TRUE)\nex2 <- left_join(ex, basins@data, by='ID')\nex3 <- full_join(ex2, basin_catch, by=c('NAME'='WB_NAME2'))\nnames(ex3) <- c('ID', 'distrib_catch', 'NAME', 'CATCH','CATCHUNITS')\nex3 <- ex3 %>% \n  filter(!is.na(CATCH)) %>% \n  filter(distrib_catch != 0) \n# mutate(distrib_catch = ifelse(distrib_catch==0, 1, distrib_catch))\n\n# calculate r2 & RMSE\nrmse(ex3$CATCH, ex3$distrib_catch)\n\nrsq <- function (x, y) cor(x, y) ^ 2\nrsq(ex3$CATCH, ex3$distrib_catch)\nrsq(log10(ex3$CATCH), log10(ex3$distrib_catch))\n\n\n\n\n# /----------------------------------------------------------------------------\n#/     Scatterplot of distrib  VS  basin catch\n\nggplot(ex3) + \n  \n  geom_abline(aes(slope=1, intercept=0), color='grey80') +\n  \n  geom_point(aes(x=CATCH, y=distrib_catch), color='black') + \n  \n  xlab('Literature catch estimates (tons/year)') +\n  ylab('Distributed catch FAO & Surveys (tons/year)') +\n  \n  # ggtitle('Comparison of monthly index and annual extents (MAMin, MAMax, IAMax)\\nfor 33 basins with both.') +\n  \n  scale_x_log10(\n    breaks = scales::trans_breaks('log10', function(x) 10^x),\n    labels = scales::trans_format('log10', scales::math_format(10^.x))) +\n  \n  scale_y_log10(\n    breaks = scales::trans_breaks('log10', function(x) 10^x),\n    labels = scales::trans_format('log10', scales::math_format(10^.x))) +\n  \n  \n  # waterbody label\n  geom_text_repel(data = ex3,  #subset(ex3, monthlykm2/10^6 > 0.2),\n                  aes(x=CATCH, y=distrib_catch, label = NAME),\n                  color='grey25',\n                  segment.color='grey25',\n                  size = 3,\n                  nudge_x = 0,\n                  segment.size = 0.25,\n                  box.padding = unit(0.5, 'mm'),\n                  point.padding = unit(0.5, 'mm')) +\n  theme_bw()\n\n\n\n\n# /----------------------------------------------------------------------------#\n#/    Save figure to file \nggsave('../output/figures/scatterplot_basin_catch_vs_distrib_lm2c.png', \n       width=160, height=160, dpi=240, units='mm', type = 'cairo-png')\ndev.off()\n\n\n\n\n\n# /-----------------------------------------------------------------------------\n#/  Calculate difference betwen models\n\nd = lm7b_distrib_c2 - lm10c_distrib_c2\n\n\nddf = as.data.frame(d) %>% filter(!is.na(layer))\n\nggplot(ddf) +\n  geom_density(aes(x=layer))\n\n\n\n\n\n\n# basinstiles_file = '../data/giemsd15/basins/tiles_giemsd15_sel_basins.shp'\n# natearth_dir <- '../../chap5_global_inland_fish_catch/data/gis/nat_earth'\n# \n# countries_df <- fortify(countries)\n# countries_robin <- spTransform(countries, CRS('+proj=robin'))\n# countries_robin_df <- fortify(countries_robin)\n# \n\n\n# ddf = fortify(d)\n# \n# lapply( s, as.data.frame ) ",
    "created" : 1581369883902.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "119476688",
    "id" : "491CFCAA",
    "lastKnownWriteTime" : 1581029593,
    "last_content_update" : 1581029593,
    "path" : "C:/Users/efluet/Dropbox/side projects/riverine_fisheries_map/scripts/data_proc/output_qaqc_sums.r",
    "project_path" : "data_proc/output_qaqc_sums.r",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}